<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Advanced Analytics & Reports - Smart Attendance System</title>
    <link rel="stylesheet" href="../css/style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- jsPDF for PDF export -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.29/jspdf.plugin.autotable.min.js"></script>
    <style>
        /* Reports Specific Styles */
        .reports-header {
            background: linear-gradient(135deg, var(--primary-600) 0%, var(--primary-800) 100%);
            color: white;
            padding: 2rem 0;
            margin-bottom: 2rem;
            position: relative;
            overflow: hidden;
        }

        .reports-header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><defs><pattern id="reports-pattern" width="20" height="20" patternUnits="userSpaceOnUse"><rect width="8" height="8" fill="rgba(255,255,255,0.05)"/><rect x="10" y="10" width="6" height="6" fill="rgba(255,255,255,0.03)"/><circle cx="5" cy="15" r="1" fill="rgba(255,255,255,0.04)"/></pattern></defs><rect width="100" height="100" fill="url(%23reports-pattern)"/></svg>');
            opacity: 0.6;
        }

        .reports-welcome {
            text-align: center;
            position: relative;
            z-index: 2;
        }

        .reports-title {
            font-size: 2.5rem;
            font-weight: 800;
            margin-bottom: 0.5rem;
            background: linear-gradient(135deg, #ffffff 0%, #e0e7ff 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .reports-subtitle {
            font-size: 1.125rem;
            opacity: 0.9;
            margin-bottom: 2rem;
        }

        .reports-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1.5rem;
            max-width: 1000px;
            margin: 0 auto;
        }

        .report-stat-card {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: var(--radius-lg);
            padding: 1.5rem;
            text-align: center;
            border: 1px solid rgba(255, 255, 255, 0.2);
            transition: all var(--transition-normal);
        }

        .report-stat-card:hover {
            transform: translateY(-4px);
            background: rgba(255, 255, 255, 0.15);
        }

        .stat-metric {
            font-size: 2rem;
            font-weight: 800;
            color: white;
            margin-bottom: 0.5rem;
        }

        .stat-label {
            font-size: 0.875rem;
            opacity: 0.8;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        /* Report Controls */
        .report-controls {
            background: var(--surface-50);
            border-radius: var(--radius-xl);
            padding: 2rem;
            margin-bottom: 2rem;
            box-shadow: var(--shadow-md);
            border: 1px solid var(--surface-200);
        }

        .controls-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .control-group {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .control-label {
            font-weight: 600;
            color: var(--text-primary);
            font-size: 0.875rem;
        }

        .control-input {
            padding: 0.75rem 1rem;
            border: 2px solid var(--surface-300);
            border-radius: var(--radius-lg);
            background: var(--surface-50);
            font-size: 0.875rem;
            transition: all var(--transition-fast);
        }

        .control-input:focus {
            outline: none;
            border-color: var(--primary-500);
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }

        .control-row {
            display: flex;
            gap: 1rem;
            align-items: end;
        }

        .control-actions {
            display: flex;
            gap: 1rem;
            justify-content: center;
            flex-wrap: wrap;
        }

        /* Layout refinement */
        .section { margin-bottom: 2rem; }

        /* Metrics Cards */
        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
        }

        .metric-card {
            background: var(--surface-50);
            border-radius: var(--radius-xl);
            padding: 2rem;
            box-shadow: var(--shadow-md);
            border: 1px solid var(--surface-200);
            transition: all var(--transition-normal);
        }

        .metric-card:hover {
            transform: translateY(-4px);
            box-shadow: var(--shadow-xl);
        }

        .metric-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 1.5rem;
        }

        .metric-title {
            font-size: 1rem;
            font-weight: 600;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .metric-icon {
            width: 40px;
            height: 40px;
            border-radius: var(--radius-lg);
            display: flex;
            align-items: center;
            justify-content: center;
            background: var(--primary-100);
            color: var(--primary-600);
        }

        .metric-value {
            font-size: 2.5rem;
            font-weight: 800;
            color: var(--text-primary);
            margin-bottom: 0.5rem;
        }

        .metric-change {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.875rem;
            font-weight: 500;
        }

        .change-up {
            color: var(--success-600);
        }

        .change-down {
            color: var(--danger-600);
        }

        .change-neutral {
            color: var(--text-secondary);
        }

        /* Data Tables */
        .data-table-container {
            background: #fff;
            border-radius: 16px;
            box-shadow: 0 10px 30px rgba(0,0,0,.08);
            overflow: hidden;
            border: 1px solid #e5e7eb;
        }

        .data-table {
            width: 100%;
            border-collapse: collapse;
        }

        .data-table th,
        .data-table td {
            padding: 1rem;
            text-align: left;
            border-bottom: 1px solid var(--surface-200);
        }

        .data-table th {
            background: #f8fafc;
            font-weight: 700;
            color: #0f172a;
            font-size: 0.85rem;
            text-transform: uppercase;
            letter-spacing: .06em;
            position: sticky;
            top: 0;
        }

        .data-table tbody tr:hover {
            background: var(--surface-50);
        }

        .table-actions {
            display: flex;
            gap: 0.5rem;
        }

        /* Export Options */
        .export-section {
            background: #fff;
            border-radius: 16px;
            padding: 1.5rem;
            box-shadow: 0 10px 30px rgba(0,0,0,.08);
            border: 1px solid #e5e7eb;
        }

        .export-title {
            font-size: 1.25rem;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 1.5rem;
            text-align: center;
        }

        .export-options {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
        }

        .export-option {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 0.75rem;
            padding: 1.25rem;
            border: 1px solid #e5e7eb;
            border-radius: 12px;
            background: #fff;
            transition: box-shadow .2s ease, transform .06s ease;
            cursor: pointer;
        }

        .export-option:hover {
            box-shadow: 0 8px 24px rgba(0,0,0,.08);
            transform: translateY(-2px);
        }

        .export-icon {
            width: 44px;
            height: 44px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.25rem;
            background: #eef2ff;
            color: #4338ca;
        }

        .export-label {
            font-weight: 600;
            color: var(--text-primary);
            text-align: center;
        }

        /* Custom Report Builder */
        .custom-report-builder {
            background: var(--surface-50);
            border-radius: var(--radius-xl);
            padding: 2rem;
            box-shadow: var(--shadow-md);
            border: 1px solid var(--surface-200);
        }

        .builder-title {
            font-size: 1.25rem;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 1.5rem;
            text-align: center;
        }

        .builder-form {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .builder-field {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .field-checkboxes {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 1rem;
            margin-top: 0.5rem;
        }

        .checkbox-group {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .checkbox-input {
            width: 1rem;
            height: 1rem;
            accent-color: var(--primary-500);
        }

        /* Loading States */
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(255, 255, 255, 0.9);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 9999;
            backdrop-filter: blur(4px);
        }

        .chart-loading {
            display: flex;
            align-items: center;
            justify-content: center;
            height: 300px;
            color: var(--text-secondary);
        }

        .chart-loading i {
            font-size: 2rem;
            margin-right: 1rem;
            animation: spin 1s linear infinite;
        }

        /* Print Styles */
        @media print {
            .navbar,
            .report-controls,
            .chart-actions,
            .export-section,
            .custom-report-builder {
                display: none !important;
            }

            .chart-card,
            .metric-card,
            .data-table-container {
                box-shadow: none !important;
                border: 1px solid #ddd !important;
            }
        }

        /* Responsive Design */
        @media (max-width: 1024px) {
            .controls-grid {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 768px) {
            .reports-title {
                font-size: 2rem;
            }

            .reports-stats {
                grid-template-columns: repeat(2, 1fr);
            }

            .metrics-grid {
                grid-template-columns: 1fr;
            }

            .export-options {
                grid-template-columns: 1fr;
            }

            .builder-form {
                grid-template-columns: 1fr;
            }

            .field-checkboxes {
                grid-template-columns: 1fr;
            }

            .control-row {
                flex-direction: column;
                gap: 0.75rem;
            }

            .control-actions {
                justify-content: stretch;
            }

            .control-actions .btn {
                flex: 1;
            }
        }

        @media (max-width: 480px) {
            .reports-header {
                padding: 1.5rem 0;
            }

            .reports-title {
                font-size: 1.75rem;
            }

            .chart-card,
            .metric-card,
            .report-controls {
                padding: 1.5rem;
            }

            .metric-value {
                font-size: 2rem;
            }
        }

        /* Dark mode disabled for this page to preserve consistent light design */
    </style>
</head>
<body class="page-container">
    <!-- Modern Navigation -->
    <nav class="navbar">
        <div class="container">
            <div class="nav-brand">
                <div class="brand-icon">
                    <i class="fas fa-chart-bar"></i>
                </div>
                <div>
                    <h1>Smart Attendance</h1>
                    <span class="nav-subtitle">Analytics & Reports</span>
                </div>
            </div>
            <div class="nav-menu">
                <a href="dashboard.html" class="nav-link">
                    <i class="fas fa-tachometer-alt"></i>
                    <span>Dashboard</span>
                </a>
                <a href="employees.html" class="nav-link">
                    <i class="fas fa-users"></i>
                    <span>Employees</span>
                </a>
                <a href="scanner.html" class="nav-link">
                    <i class="fas fa-qrcode"></i>
                    <span>Scanner</span>
                </a>
                <a href="reports.html" class="nav-link active">
                    <i class="fas fa-chart-bar"></i>
                    <span>Reports</span>
                </a>
                <a href="#" class="nav-link" onclick="handleLogout()">
                    <i class="fas fa-sign-out-alt"></i>
                    <span>Logout</span>
                </a>
            </div>
        </div>
    </nav>

    <!-- Reports Header -->
    <header class="reports-header">
        <div class="container">
            <div class="reports-welcome">
                <h1 class="reports-title">Advanced Analytics & Reports</h1>
                <p class="reports-subtitle">Comprehensive insights into attendance patterns, performance metrics, and organizational analytics</p>

                <div class="reports-stats">
                    <div class="report-stat-card">
                        <div class="stat-metric" id="totalReports">1,247</div>
                        <div class="stat-label">Total Records</div>
                    </div>
                    <div class="report-stat-card">
                        <div class="stat-metric" id="avgAttendance">94.2%</div>
                        <div class="stat-label">Avg Attendance</div>
                    </div>
                    <div class="report-stat-card">
                        <div class="stat-metric" id="activeReports">892</div>
                        <div class="stat-label">Active Users</div>
                    </div>
                    <div class="report-stat-card">
                        <div class="stat-metric" id="reportsGenerated">156</div>
                        <div class="stat-label">Reports Generated</div>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="container">
        <!-- Report Controls -->
        <div class="report-controls">
            <div class="controls-grid">
                <div class="control-group">
                    <label class="control-label">Report Type</label>
                    <select class="control-input" id="reportType">
                        <option value="attendance">Attendance Report</option>
                        <option value="performance">Performance Analytics</option>
                        <option value="department">Department Summary</option>
                        <option value="trends">Trend Analysis</option>
                        <option value="custom">Custom Report</option>
                    </select>
                </div>

                <div class="control-group">
                    <label class="control-label">Time Period</label>
                    <select class="control-input" id="timePeriod">
                        <option value="today">Today</option>
                        <option value="week">This Week</option>
                        <option value="month" selected>This Month</option>
                        <option value="quarter">This Quarter</option>
                        <option value="year">This Year</option>
                        <option value="custom">Custom Range</option>
                    </select>
                </div>

                <div class="control-group" id="departmentFilter">
                    <label class="control-label">Department</label>
                    <select class="control-input" id="departmentSelect">
                        <option value="all">All Departments</option>
                        <option value="engineering">Engineering</option>
                        <option value="marketing">Marketing</option>
                        <option value="sales">Sales</option>
                        <option value="hr">Human Resources</option>
                        <option value="finance">Finance</option>
                    </select>
                </div>

                <div class="control-group" id="dateRangeGroup" style="display: none;">
                    <label class="control-label">Date Range</label>
                    <div class="control-row">
                        <input type="date" class="control-input" id="startDate">
                        <input type="date" class="control-input" id="endDate">
                    </div>
                </div>
            </div>

            <div class="control-actions">
                <button class="btn btn-primary" onclick="generateReport()">
                    <i class="fas fa-chart-line"></i>
                    Generate Report
                </button>
                <button class="btn btn-outline" onclick="resetFilters()">
                    <i class="fas fa-undo"></i>
                    Reset
                </button>
                <button class="btn btn-secondary" onclick="scheduleReport()">
                    <i class="fas fa-clock"></i>
                    Schedule
                </button>
            </div>
        </div>

        <!-- KPI Metrics -->
        <div class="section">
            <div class="metrics-grid">
                <div class="metric-card">
                    <div class="metric-header">
                        <span class="metric-title">Present Today</span>
                        <div class="metric-icon">
                            <i class="fas fa-user-check"></i>
                        </div>
                    </div>
                    <div class="metric-value" id="presentToday">0</div>
                    <div class="metric-change change-up">
                        <i class="fas fa-arrow-up"></i>
                        <span id="presentChange">+5.2% from yesterday</span>
                    </div>
                </div>

                <div class="metric-card">
                    <div class="metric-header">
                        <span class="metric-title">Late Arrivals</span>
                        <div class="metric-icon">
                            <i class="fas fa-clock"></i>
                        </div>
                    </div>
                    <div class="metric-value" id="lateToday">0</div>
                    <div class="metric-change change-down">
                        <i class="fas fa-arrow-down"></i>
                        <span id="lateChange">-12.1% from yesterday</span>
                    </div>
                </div>

                <div class="metric-card">
                    <div class="metric-header">
                        <span class="metric-title">Avg Check-in</span>
                        <div class="metric-icon">
                            <i class="fas fa-calendar-check"></i>
                        </div>
                    </div>
                    <div class="metric-value" id="avgCheckIn">9:15 AM</div>
                    <div class="metric-change change-neutral">
                        <i class="fas fa-equals"></i>
                        <span id="checkInChange">Same as yesterday</span>
                    </div>
                </div>

                <div class="metric-card">
                    <div class="metric-header">
                        <span class="metric-title">Absent Rate</span>
                        <div class="metric-icon">
                            <i class="fas fa-user-times"></i>
                        </div>
                    </div>
                    <div class="metric-value" id="absentRate">5.8%</div>
                    <div class="metric-change change-up">
                        <i class="fas fa-arrow-up"></i>
                        <span id="absentChange">+0.3% from yesterday</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Detailed Reports Table -->
        <div class="data-table-container">
            <div class="chart-header">
                <h2 class="chart-title">
                    <div class="chart-icon">
                        <i class="fas fa-table"></i>
                    </div>
                    Detailed Report Data
                </h2>
                <div class="chart-actions">
                    <button class="btn btn-sm btn-outline" onclick="refreshTable()">
                        <i class="fas fa-sync-alt"></i>
                        Refresh
                    </button>
                    <button class="btn btn-sm btn-primary" onclick="exportToCSV()">
                        <i class="fas fa-download"></i>
                        CSV
                    </button>
                    <button class="btn btn-sm btn-primary" onclick="exportToPDF()">
                        <i class="fas fa-file-pdf"></i>
                        PDF
                    </button>
                </div>
            </div>
            <div id="tableLoading" class="chart-loading">
                <i class="fas fa-spinner"></i>
                <span>Loading table data...</span>
            </div>
            <div id="tableContainer" style="display: none; overflow-x: auto;">
                <table class="data-table" id="reportsTable">
                    <thead>
                        <tr>
                            <th>Employee</th>
                            <th>Department</th>
                            <th>Date</th>
                            <th>Check-in</th>
                            <th>Check-out</th>
                            <th>Status</th>
                            <th>Duration</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="reportsTableBody">
                        <!-- Table data will be populated by JavaScript -->
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Export Options -->
        <div class="export-section">
            <h2 class="export-title">Export Options</h2>
            <div class="export-options">
                <div class="export-option" onclick="exportToPDF()">
                    <div class="export-icon">
                        <i class="fas fa-file-pdf"></i>
                    </div>
                    <div class="export-label">PDF Report</div>
                    <small style="color: var(--text-secondary);">Professional PDF with charts</small>
                </div>

                <div class="export-option" onclick="exportToCSV()">
                    <div class="export-icon">
                        <i class="fas fa-file-csv"></i>
                    </div>
                    <div class="export-label">CSV Data</div>
                    <small style="color: var(--text-secondary);">Raw data for analysis</small>
                </div>

                <div class="export-option" onclick="exportToExcel()">
                    <div class="export-icon">
                        <i class="fas fa-file-excel"></i>
                    </div>
                    <div class="export-label">Excel Workbook</div>
                    <small style="color: var(--text-secondary);">Formatted spreadsheet</small>
                </div>

                <div class="export-option" onclick="printReport()">
                    <div class="export-icon">
                        <i class="fas fa-print"></i>
                    </div>
                    <div class="export-label">Print Report</div>
                    <small style="color: var(--text-secondary);">Print-friendly layout</small>
                </div>
            </div>
        </div>

        <!-- Custom Report Builder -->
        <div class="custom-report-builder">
            <h2 class="builder-title">Custom Report Builder</h2>
            <div class="builder-form">
                <div class="builder-field">
                    <label class="control-label">Report Name</label>
                    <input type="text" class="control-input" id="customReportName" placeholder="Enter report name">
                </div>

                <div class="builder-field">
                    <label class="control-label">Data Fields</label>
                    <div class="field-checkboxes">
                        <label class="checkbox-group">
                            <input type="checkbox" class="checkbox-input" value="name" checked>
                            <span>Name</span>
                        </label>
                        <label class="checkbox-group">
                            <input type="checkbox" class="checkbox-input" value="department" checked>
                            <span>Department</span>
                        </label>
                        <label class="checkbox-group">
                            <input type="checkbox" class="checkbox-input" value="checkin" checked>
                            <span>Check-in Time</span>
                        </label>
                        <label class="checkbox-group">
                            <input type="checkbox" class="checkbox-input" value="checkout" checked>
                            <span>Check-out Time</span>
                        </label>
                        <label class="checkbox-group">
                            <input type="checkbox" class="checkbox-input" value="status">
                            <span>Status</span>
                        </label>
                        <label class="checkbox-group">
                            <input type="checkbox" class="checkbox-input" value="duration">
                            <span>Duration</span>
                        </label>
                    </div>
                </div>

                <div class="builder-field">
                    <label class="control-label">Sort By</label>
                    <select class="control-input" id="customSortBy">
                        <option value="name">Name</option>
                        <option value="department">Department</option>
                        <option value="date">Date</option>
                        <option value="checkin">Check-in Time</option>
                    </select>
                </div>

                <div class="builder-field">
                    <label class="control-label">Order</label>
                    <select class="control-input" id="customOrder">
                        <option value="asc">Ascending</option>
                        <option value="desc">Descending</option>
                    </select>
                </div>
            </div>

            <div style="text-align: center;">
                <button class="btn btn-primary" onclick="generateCustomReport()">
                    <i class="fas fa-magic"></i>
                    Generate Custom Report
                </button>
            </div>
        </div>
    </main>

    <!-- Loading Overlay -->
    <div id="loadingOverlay" class="loading-overlay" style="display: none;">
        <div style="text-align: center; color: var(--text-primary);">
            <div style="width: 60px; height: 60px; border: 4px solid var(--surface-300); border-top: 4px solid var(--primary-500); border-radius: 50%; animation: spin 1s linear infinite; margin: 0 auto 2rem;"></div>
            <h3>Generating Report...</h3>
            <p>Processing your data and creating visualizations</p>
        </div>
    </div>

    <script src="../js/reports.js"></script>
    <script>
        // Enhanced reports functionality
        let currentChart = null;
        let reportData = [];

        // Initialize reports page
        document.addEventListener('DOMContentLoaded', function() {
            initializeReports();
            setupEventListeners();
        });

        function initializeReports() {
            // Show loading
            showLoading();

            // Simulate data loading
            setTimeout(() => {
                loadMockData();
                populateTable();
                updateMetrics();
                hideLoading();
            }, 1500);
        }

        function setupEventListeners() {
            // Time period selector
            document.getElementById('timePeriod').addEventListener('change', function() {
                const dateRangeGroup = document.getElementById('dateRangeGroup');
                dateRangeGroup.style.display = this.value === 'custom' ? 'block' : 'none';
            });

            // No chart controls anymore

            // Report type change
            document.getElementById('reportType').addEventListener('change', function() {
                updateReportType(this.value);
            });
        }

        function loadMockData() {
            // Mock attendance data
            reportData = [
                {
                    id: 1,
                    name: 'John Doe',
                    department: 'Engineering',
                    date: '2024-01-15',
                    checkin: '09:15',
                    checkout: '17:45',
                    status: 'Present',
                    duration: '8h 30m'
                },
                {
                    id: 2,
                    name: 'Jane Smith',
                    department: 'Marketing',
                    date: '2024-01-15',
                    checkin: '09:30',
                    checkout: '18:00',
                    status: 'Present',
                    duration: '8h 30m'
                },
                {
                    id: 3,
                    name: 'Bob Johnson',
                    department: 'Sales',
                    date: '2024-01-15',
                    checkin: '10:00',
                    checkout: '17:30',
                    status: 'Late',
                    duration: '7h 30m'
                },
                {
                    id: 4,
                    name: 'Alice Brown',
                    department: 'Engineering',
                    date: '2024-01-15',
                    checkin: '09:00',
                    checkout: '17:00',
                    status: 'Present',
                    duration: '8h 0m'
                },
                {
                    id: 5,
                    name: 'Charlie Wilson',
                    department: 'Finance',
                    date: '2024-01-15',
                    checkin: null,
                    checkout: null,
                    status: 'Absent',
                    duration: '0h 0m'
                }
            ];
        }

        // Chart removed

        function populateTable() {
            const tbody = document.getElementById('reportsTableBody');

            // Hide loading, show table
            document.getElementById('tableLoading').style.display = 'none';
            document.getElementById('tableContainer').style.display = 'block';

            tbody.innerHTML = reportData.map(employee => `
                <tr>
                    <td>
                        <div style="display: flex; align-items: center; gap: 0.75rem;">
                            <div style="width: 32px; height: 32px; border-radius: 50%; background: var(--primary-100); display: flex; align-items: center; justify-content: center; font-weight: 600; color: var(--primary-600);">
                                ${employee.name.split(' ').map(n => n[0]).join('')}
                            </div>
                            <span style="font-weight: 500;">${employee.name}</span>
                        </div>
                    </td>
                    <td>${employee.department}</td>
                    <td>${new Date(employee.date).toLocaleDateString()}</td>
                    <td>${employee.checkin || '-'}</td>
                    <td>${employee.checkout || '-'}</td>
                    <td>
                        <span style="padding: 0.25rem 0.75rem; border-radius: 1rem; font-size: 0.75rem; font-weight: 600; ${
                            employee.status === 'Present' ? 'background: rgba(34, 197, 94, 0.1); color: var(--success-700);' :
                            employee.status === 'Late' ? 'background: rgba(245, 158, 11, 0.1); color: var(--warning-700);' :
                            'background: rgba(239, 68, 68, 0.1); color: var(--danger-700);'
                        }">
                            ${employee.status}
                        </span>
                    </td>
                    <td>${employee.duration}</td>
                    <td>
                        <div class="table-actions">
                            <button class="btn btn-sm btn-outline" onclick="viewEmployeeDetails(${employee.id})">
                                <i class="fas fa-eye"></i>
                            </button>
                            <button class="btn btn-sm btn-outline" onclick="downloadEmployeeReport(${employee.id})">
                                <i class="fas fa-download"></i>
                            </button>
                        </div>
                    </td>
                </tr>
            `).join('');
        }

        function updateMetrics() {
            const presentToday = reportData.filter(e => e.status === 'Present').length;
            const lateToday = reportData.filter(e => e.status === 'Late').length;
            const absentToday = reportData.filter(e => e.status === 'Absent').length;

            document.getElementById('presentToday').textContent = presentToday;
            document.getElementById('lateToday').textContent = lateToday;
            document.getElementById('absentRate').textContent = Math.round((absentToday / reportData.length) * 100) + '%';

            // Update header stats
            document.getElementById('totalReports').textContent = reportData.length.toLocaleString();
            document.getElementById('avgAttendance').textContent = Math.round((presentToday / reportData.length) * 100) + '%';
            document.getElementById('activeReports').textContent = reportData.filter(e => e.status !== 'Absent').length;
            document.getElementById('reportsGenerated').textContent = '42';
        }

        function updateReportType(type) {
            // Update UI based on report type
            const departmentFilter = document.getElementById('departmentFilter');
            departmentFilter.style.display = ['department', 'custom'].includes(type) ? 'block' : 'none';
        }

        function generateReport() {
            showNotification('Generating report...', 'info');

            setTimeout(() => {
                showNotification('Report generated successfully!', 'success');
            }, 2000);
        }

        function resetFilters() {
            document.getElementById('reportType').value = 'attendance';
            document.getElementById('timePeriod').value = 'month';
            document.getElementById('departmentSelect').value = 'all';
            document.getElementById('dateRangeGroup').style.display = 'none';

            updateReportType('attendance');
            showNotification('Filters reset', 'info');
        }

        function scheduleReport() {
            alert('Report scheduling feature will be available in the next update. You can set up automated report generation and email delivery.');
        }

        function refreshTable() {
            showLoading();
            setTimeout(() => {
                populateTable();
                hideLoading();
                showNotification('Table refreshed', 'success');
            }, 1000);
        }

        function exportToCSV() {
            const csv = [
                ['Name', 'Department', 'Date', 'Check-in', 'Check-out', 'Status', 'Duration'],
                ...reportData.map(row => [
                    row.name,
                    row.department,
                    row.date,
                    row.checkin || '',
                    row.checkout || '',
                    row.status,
                    row.duration
                ])
            ].map(row => row.map(cell => `"${cell}"`).join(',')).join('\n');

            downloadFile(csv, 'attendance-report.csv', 'text/csv');
            showNotification('CSV exported successfully', 'success');
        }

        function exportToPDF() {
            try {
            showNotification('Generating PDF report...', 'info');

                const { jsPDF } = window.jspdf;
                const doc = new jsPDF({ orientation: 'landscape', unit: 'pt', format: 'a4' });
                const margin = 40;
                const pageWidth = doc.internal.pageSize.getWidth();
                const pageHeight = doc.internal.pageSize.getHeight();

                // Header
                doc.setFont('helvetica', 'bold');
                doc.setFontSize(18);
                doc.text('ECC Smart Attendance - Attendance Report', margin, margin);
                doc.setFont('helvetica', 'normal');
                doc.setFontSize(11);

                // Filters summary
                const type = (document.getElementById('reportType') || {}).value || 'attendance';
                const period = (document.getElementById('timePeriod') || {}).value || 'month';
                const dept = (document.getElementById('departmentSelect') || {}).value || 'all';
                const startDate = (document.getElementById('startDate') || {}).value || '';
                const endDate = (document.getElementById('endDate') || {}).value || '';
                const when = new Date().toLocaleString();
                const filterLine1 = `Type: ${type}  •  Period: ${period}  •  Department: ${dept}`;
                const filterLine2 = (period === 'custom' && startDate && endDate) ? `Range: ${startDate} → ${endDate}` : '';
                const genLine = `Generated: ${when}`;
                doc.text(filterLine1, margin, margin + 18);
                if (filterLine2) doc.text(filterLine2, margin, margin + 34);
                doc.text(genLine, pageWidth - margin, margin + 18, { align: 'right' });

                // Summary metrics (simple inline summary)
                try {
                    const presentToday = reportData.filter(e => e.status === 'Present').length;
                    const lateToday = reportData.filter(e => e.status === 'Late').length;
                    const absentToday = reportData.filter(e => e.status === 'Absent').length;
                    const total = reportData.length;
                    const summary = `Summary  •  Total: ${total}  |  Present: ${presentToday}  |  Late: ${lateToday}  |  Absent: ${absentToday}`;
                    doc.setFontSize(12);
                    doc.text(summary, margin, margin + 52);
                } catch (_) {}

                // Reserve space for table top, no chart
                let yAfterChart = margin + 64;

                // Build table data
                const head = [['Employee', 'Department', 'Date', 'Check-in', 'Check-out', 'Status', 'Duration']];
                const body = (Array.isArray(reportData) ? reportData : []).map(r => [
                    r.name || '-',
                    r.department || '-',
                    r.date ? new Date(r.date).toLocaleDateString() : '-',
                    r.checkin || '-',
                    r.checkout || '-',
                    r.status || '-',
                    r.duration || '-'
                ]);

                // Render table with autoTable
                if (doc.autoTable) {
                    doc.autoTable({
                        head,
                        body,
                        startY: yAfterChart,
                        styles: { fontSize: 9 },
                        headStyles: { fillColor: [79, 70, 229], textColor: 255 },
                        alternateRowStyles: { fillColor: [245, 247, 250] },
                        margin: { left: margin, right: margin },
                        didDrawPage: function (data) {
                            // Footer - page numbers
                            const pageCount = doc.internal.getNumberOfPages();
                            const pageStr = `Page ${doc.internal.getCurrentPageInfo().pageNumber} of ${pageCount}`;
                            doc.setFontSize(9);
                            doc.text(pageStr, pageWidth - margin, pageHeight - 10, { align: 'right' });
                        }
                    });
                } else {
                    // Fallback if autoTable missing
                    doc.setFontSize(12);
                    doc.text('Table data unavailable (autoTable not loaded)', margin, yAfterChart + 20);
                }

                // Save
                doc.save('attendance-report.pdf');
                showNotification('PDF exported successfully', 'success');
            } catch (e) {
                console.error('PDF export error:', e);
                showNotification('Failed to export PDF', 'error');
            }
        }

        function exportToExcel() {
            showNotification('Generating Excel workbook...', 'info');

            setTimeout(() => {
                showNotification('Excel workbook generated successfully!', 'success');
                alert('Excel export functionality would create a formatted spreadsheet with multiple sheets and charts.');
            }, 2000);
        }

        function printReport() {
            window.print();
        }

        function generateCustomReport() {
            const reportName = document.getElementById('customReportName').value;
            if (!reportName) {
                showNotification('Please enter a report name', 'error');
                return;
            }

            showNotification(`Generating custom report: ${reportName}`, 'info');

            setTimeout(() => {
                showNotification('Custom report generated successfully!', 'success');
            }, 2000);
        }

        function viewEmployeeDetails(id) {
            const employee = reportData.find(e => e.id === id);
            if (employee) {
                alert(`Employee Details:\n\nName: ${employee.name}\nDepartment: ${employee.department}\nStatus: ${employee.status}\nDuration: ${employee.duration}`);
            }
        }

        function downloadEmployeeReport(id) {
            showNotification('Downloading employee report...', 'info');

            setTimeout(() => {
                showNotification('Employee report downloaded', 'success');
            }, 1000);
        }

        function downloadFile(content, filename, mimeType) {
            const blob = new Blob([content], { type: mimeType });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            a.click();
            window.URL.revokeObjectURL(url);
        }

        function showLoading() {
            document.getElementById('loadingOverlay').style.display = 'flex';
        }

        function hideLoading() {
            document.getElementById('loadingOverlay').style.display = 'none';
        }

        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: ${type === 'success' ? '#22c55e' : type === 'error' ? '#ef4444' : '#3b82f6'};
                color: white;
                padding: 1rem 1.5rem;
                border-radius: 0.5rem;
                box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
                z-index: 10000;
                transform: translateX(100%);
                transition: transform 0.3s ease;
                max-width: 400px;
            `;

            notification.innerHTML = `
                <div style="display: flex; align-items: center; gap: 0.75rem;">
                    <i class="fas fa-${type === 'success' ? 'check-circle' : type === 'error' ? 'exclamation-circle' : 'info-circle'}"></i>
                    <span>${message}</span>
                    <button onclick="this.parentElement.remove()" style="margin-left: auto; background: none; border: none; color: white; cursor: pointer;">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
            `;

            document.body.appendChild(notification);

            setTimeout(() => {
                notification.style.transform = 'translateX(0)';
            }, 100);

            setTimeout(() => {
                if (notification.parentElement) {
                    notification.remove();
                }
            }, 5000);
        }

        function handleLogout() {
            if (confirm('Are you sure you want to logout?')) {
                const base = window.location.origin.includes(':5000') ? window.location.origin : 'http://localhost:5000';
                window.location.href = base + '/signin.html';
            }
        }
    </script>
</body>
<script>
(function(){
    const base = window.location.origin.includes(':5000') ? window.location.origin : 'http://localhost:5000';
    const navLinks = [
        ['a.nav-link[href="dashboard.html"]', '/dashboard.html'],
        ['a.nav-link[href="employees.html"]', '/employees.html'],
        ['a.nav-link[href="scanner.html"]', '/scanner.html'],
        ['a.nav-link[href="reports.html"]', '/reports.html']
    ];
    navLinks.forEach(([sel, path]) => {
        const el = document.querySelector(sel);
        if (el) el.href = base + path;
    });
})();
</script>
</html>
